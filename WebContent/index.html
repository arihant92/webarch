
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Web Arch</title>

<!-- Bootstrap -->
<link rel="icon" type="image/png" href="img/app-64.png"/>
<link href="css/bootstrap.min.css" rel="stylesheet"/>
<link href="css/webarch.css" rel="stylesheet"/>
  <script src="https://d3js.org/d3.v3.js" charset="utf-8">
  var global_array=[];
  var global_paths=[];
  var global_text=[];
  var redraw_path=[];
  var global_move={};




</script>
  <script src="https://togetherjs.com/togetherjs-min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jsPlumb/2.0.7/jsPlumb.js"></script>








<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>


	<nav class="navbar navbar-default hidden-print" role="navigation">
		<div class="container-fluid">
			<!-- Brand and toggle get grouped for better mobile display -->
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse"
					data-target="#bs-example-navbar-collapse-1">
					<span class="sr-only">Toggle navigation</span> <span
						class="icon-bar"></span> <span class="icon-bar"></span> <span
						class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="#">Web-Arch</a>
			</div>

			<!-- Collect the nav links, forms, and other content for toggling -->
			<div class="collapse navbar-collapse"
				id="bs-example-navbar-collapse-1">
				<ul class="nav navbar-nav">
					<li class="dropdown"><a href="#" class="dropdown-toggle"
						data-toggle="dropdown">File <b class="caret"></b></a>
						<ul class="dropdown-menu">
							<li><a href="http://theopengroup.org/standards/security">The
									Open Group Security Standards</a></li>
							<li class="divider"></li>
							<li><a href="https://www2.opengroup.org/ogsys/catalog/C13G">Risk
									Analysis (O-RA)</a></li>
							<li><a href="https://www2.opengroup.org/ogsys/catalog/C13K">Risk
									Taxonomy (O-RT)</a></li>
						</ul></li>
				</ul>
				<ul class="nav navbar-nav">

					<li class="dropdown"><a href="#" class="dropdown-toggle"
						data-toggle="dropdown">Edit <b class="caret"></b></a></li>
				</ul>
				<ul class="nav navbar-nav">

					<li class="dropdown"><a href="#" class="dropdown-toggle"
						data-toggle="dropdown">View <b class="caret"></b></a></li>
				</ul>
				<ul class="nav navbar-nav">

					<li class="dropdown"><a href="#" class="dropdown-toggle"
						data-toggle="dropdown">Window <b class="caret"></b></a></li>
				</ul>
				<ul class="nav navbar-nav navbar-right">
					<li class="dropdown"><a href="#" class="dropdown-toggle"
						data-toggle="dropdown">Help <b class="caret"></b></a>
						<ul class="dropdown-menu">
							<li><a href="http://www.archimatetool.com">Archimate</a></li>
							<li class="divider"></li>
						</ul></li>
				</ul>
			</div>
			<!-- /.navbar-collapse -->

			<!-- Collect the nav links, forms, and other content for toggling -->
			<div class="collapse navbar-collapse"
				id="bs-example-navbar-collapse-1">
				<button type="button" class="btn btn-default navbar-btn">Sign
					in</button>
				<button type="button" class="btn btn-default navbar-btn">Sign
					in</button>
				<button type="button" class="btn btn-default navbar-btn">Sign
					in</button>
				<button type="button" class="btn btn-default navbar-btn">Sign
					in</button>
				<button type="button" class="btn btn-default navbar-btn">Sign
					in</button>


			</div>
			<!-- /.navbar-collapse -->

		</div>
		<!-- /.container-fluid -->
	</nav>


	<div class="container-fluid">
		<div class="row">
			<div class="col-md-2">
				<div class="row">
					<div class="panel panel-default">
						<div class="panel-body">
							<div class="collapse navbar-collapse">
								<span class="nav-tabs">Models</span>
								<button type="button"
									class="btn btn-default navbar-btn navbar-right">X</button>
							</div>
						</div>
					</div>
				</div>
				<hr />
				<div class="row">
					<div class="panel panel-default">
						<div class="panel-body">
							<ul class="nav nav-tabs" role="tablist">
								<li class="active"><a href="#outline" role="tab"
									data-toggle="tab">Outline</a></li>
								<li><a href="#navigator" role="tab" data-toggle="tab">Navigator</a></li>
								<li><a href="#hints" role="tab" data-toggle="tab">Hints</a></li>
							</ul>
							<div class="tab-content">
								<div class="tab-pane fade in active" id="outline">Outline
									Content</div>
								<div class="tab-pane fade" id="navigator">Navigator
									Content</div>
								<div class="tab-pane fade" id="hints">Hints Content</div>
							</div>
						</div>
					</div>

				</div>
			</div>

			<!-- Drawing Panel -->
			<div class="col-md-8">
				<div class="panel panel-default">
					<div class="panel-body">
						<div id="svg_editor" style="width:100%; height:500px; border: 10px solid black; overflow:auto" >

						</div>
					</div>
				</div>


			</div>

			<!-- Palette Panel -->
			<div class="col-md-2">
				<div class="panel-group" id="accordion" style="height:800px; overflow:auto">
					<div class="panel-header">Palette</div>
					<div class="panel-body">


						<div class="panel panel-default">

							<div id="collapseOne" class="panel-collapse collapse in">
								<div class="panel-body">
									<a onclick="selectTool(new Relationship())"><img src="img/magic_connection.gif"/> Magic Connector</a>
									<br/>
									<a href="#one"><img src="img/archimate/specialisation-16.png"/> Specializaiton</a>
									<br/>
									<a href="#two"><img src="img/archimate/composition-16.png"/>Composition relation</a>
									<br/>
									<a onclick="selectTool(new newline())"><img src="img/archimate/aggregation-16.png"/> Aggregation relation</a>
									<br/>
									<a onclick="selectTool(new plumb())"><img src="img/archimate/assignment-16.png"/> Assignment relation</a>
									<br/>
									<a onclick="trycapture()"><img src="img/archimate/realisation-16.png"/> Realization relation</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/triggering-16.png"/> Triggering relation</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/flow-16.png"/> Flow relation</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/used-by-16.png"/> Used by relation</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/access-16.png"/> Access relation</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/association-16.png"/> Association relation</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/influence-16.png"/> Influence relation</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/junction-16.png"/> Junction relation</a>
								</div>
							</div>
						</div>
						<div class="panel panel-default">

							<div id="collapseThree" class="panel-collapse">
								<div class="panel-body">
									<a onclick="selectTool()"><img src="img/note-16.gif"/> Note</a>
									<br/>
									<a onclick="selectTool()"><img src="img/group-16.png"/> Group</a>
									<br/>
									<a onclick="selectTool()"><img src="img/connection-plain-16.png"/> Connection</a>


								</div>
							</div>
						</div>

						<div class="panel panel-default">

							<div id="collapseTwo" class="panel-collapse">
								<div class="panel-body">

									<a onclick="selectTool()"><img src="img/archimate/business-actor-16.png"/> Actor</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/business-role-16.png"/> Role</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/business-collaboration-16.png"/> Collaboration</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/business-interface-16.png"/> Interface</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/business-function-16.png"/> Function</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/business-process-16.png"/> Process</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/business-event-16.png"/> Event</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/business-interaction-16.png"/> Interaction</a>
									<br/>
									<a onclick="selectTool(new BusinessProductFigure());"><img src="img/archimate/business-product-16.png"/> Product</a>
									<br/>
									<a onclick="selectTool(new BusinessContractFigure());"><img src="img/archimate/business-contract-16.png"/> Contract</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/business-service-16.png"/> Service</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/business-value-16.png"/> Value</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/business-meaning-16.png"/> Meaning</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/business-representation-16.png"/> Representation</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/business-object-16.png"/> Object</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/business-location-16.png"/> Location</a>

								</div>
							</div>
						</div>
						<div class="panel panel-default">

							<div id="collapseThree" class="panel-collapse">
								<div class="panel-body">

									<a onclick="selectTool()"><img src="img/archimate/application-component-16.png"/> Component</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/application-collaboration-16.png"/> Collaboration</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/application-interface-16.png"/> Interface</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/application-service-16.png"/> Service</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/application-function-16.png"/> Function</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/application-interaction-16.png"/> Interaction</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/application-data-object-16.png"/> Data Object</a>
								</div>
							</div>
						</div>

						<div class="panel panel-default">

							<div id="collapseThree" class="panel-collapse">
								<div class="panel-body">

									<a onclick="selectTool()"><img src="img/archimate/technology-artifact-16.png"/> Artifact</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/technology-communication-path-16.png"/> Communication Path</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/technology-network-16.png"/> Network</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/technology-infra-interface-16.png"/> Infrastructure Interface</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/technology-function-16.png"/> Infrastructure Function</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/technology-infra-service-16.png"/> Infrastructure Service</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/technology-node-16.png"/> Node</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/technology-system-software-16.png"/> System Software</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/technology-device-16.png"/> Device</a>
								</div>
							</div>
						</div>

						<div class="panel panel-default">

							<div id="collapseThree" class="panel-collapse">
								<div class="panel-body">

									<a onclick="selectTool()"><img src="img/archimate/stakeholder-filled-16.png"/> Stakeholder</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/driver-filled-16.png"/> Driver</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/assessment-filled-16.png"/> Assessment</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/goal-filled-16.png"/> Goal</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/principle-filled-16.png"/> Principle</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/requirement-filled-16.png"/> Requirement</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/constraint-filled-16.png"/> Constraint</a>
								</div>
							</div>
						</div>

						<div class="panel panel-default">

							<div id="collapseThree" class="panel-collapse">
								<div class="panel-body">

									<a onclick="selectTool()"><img src="img/archimate/workpackage-filled-16.png"/> Work Package</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/deliverable-filled-16.png"/> Deliverable</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/plateau-16.png"/> Plateau</a>
									<br/>
									<a onclick="selectTool()"><img src="img/archimate/gap-filled-16.png"/> Gap</a>

								</div>
							</div>
						</div>

					</div>
				</div>

			</div>
		</div>

	</div>
	<!-- /.container -->

	<!-- Text Input Area -->
	<input type="text" id="text-input" value="">

	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
	<script src="js/lib/jquery.js"></script>
	<!-- Include all compiled plugins (below), or include individual files as needed -->
	<script src="js/lib/bootstrap.min.js"></script>



	<!-- always minified scripts -->
	<script src="js/lib/jquery-ui.min.js"></script>
	<script src="js/lib/d3.js"></script>

	<!-- Socket.io -->
	<!-- <script src="/socket.io/socket.io.js">-->
	<script src="/socket.io/socket.io.js"></script>
  <script src="socket.io.js"></script>
	<!-- Archimate Files -->
  <script src="js/archimate/Figure.js"></script>
	<script src="js/archimate/webarch.js"></script>



	<script src="js/archimate/BusinessContractFigure.js"></script>
	<script src="js/archimate/BusinessProductFigure.js"></script>
	<script src="js/archimate/line.js"></script>
	<script src="js/archimate/Relationship.js"></script>
	<script src="js/archimate/RelationshipAssociation.js"></script>
  <script src="js/archimate/mousetrap.min.js"></script>
  <script src="js/archimate/persistence.js"></script>

	<script src="js/main.js"></script>
  <button onclick="TogetherJS(this); return false;">Collaborate</button>
<script type="text/javascript">


  socket
    .on('initialize path', function (initial_global_path) {
      //global_paths =[];
      global_paths = initial_global_path;
      //console.log(global_paths);


      //var try_obj = new trycapture;//instead of object of whole function just create object of draw function
      if(global_paths==''){}else{
        for (var i=0;i<global_paths.length;i++)
      { //var try_obj = new drawAggregate(1,2,3,4,'asd');

    // if(screen_relations.find(global_paths[i])==undefined)
      drawAggregate(global_paths[i].x1,global_paths[i].y1,global_paths[i].x2,global_paths[i].y2,global_paths[i].id);


  }
 }

    })


    socket
      .on('initialize path array', function (initial_global_path,id,x,y) {
         redraw_path=initial_global_path;
         redraw(id,x,y);
      console.log("in new emit",redraw_path);
        var relations_on_canvas = document.getElementsByTagName('path');
        //console.log(document.getElementsByTagName('path'));
        var screen_relations=[];
        //for (var z=0;z<redraw_canvas.length; z++)
        //{
          //screen_relations.push(relations_on_canvas[z].getAttribute('id'));
        //}

      })

  </script>
<script src="trycapture.js"></script>
<script type="text/javascript">
var global_obj=[];

//console.log(global_obj);


socket
  .on('initialize array', function (initial_global_array,initial_global_move) {
    global_array = initial_global_array;
    global_move = initial_global_move;
    //console.log("moving array",global_move);

var c = d3.select("#main_svg");
      socket
      .on('initialize move',function(data){
        //console.log(global_move);

      var moves_length=Object.keys(global_move).length;
      //console.log(moves_length);
      for(var i=0;i<moves_length;i++)
      {
        key =(Object.keys(data)[i]);
      global_obj.push(key);
       //console.log(global_obj);
      var x=global_move[key].x;
      var y=global_move[key].y;

     BusinessProductFigure.prototype.addTo(c,x,y,key);
      }//moves for loop


})//moves


console.log(global_obj);




    parser = new DOMParser();
    //console.log(global_array);
    for(var i=0; i<global_array.length; i++){
    var doc = parser.parseFromString(global_array[i].obj, "image/svg+xml");
    //console.log(i);
    var type = doc.getElementsByTagName('svg')[0].getAttribute("data");
    var x = doc.getElementsByTagName('svg')[0].getAttribute("x");
    var y = doc.getElementsByTagName('svg')[0].getAttribute("y");
    var id = doc.getElementsByTagName('svg')[0].getAttribute("id");
    if(type == "BusinessProductFigure"){


      BusinessProductFigure.prototype.addTo(c,x,y,id);


      //console.log(arrayObjectIndexOfall(global_move, id, "id"));
    }
  }//EOF for loop


})





    socket
      .on('initialize text', function (initial_global_text) {
        global_text = initial_global_text;
    var obj = {}, unique_global_text = [];

// in the end the last unique object will be considered
global_text.forEach(function(v){
    obj[v['id']] = v;
});
unique_global_text = Object.keys(obj).map(function(id) { return obj[id]; });
//console.log(new_arr);
//console.log(JSON.stringify(new_arr, 0, 4));

//////////////////////////////////////////////
        if(global_text==''){}else{
          for(var i=0;i<unique_global_text.length; i++){
            //console.log(unique_global_text[i].id);
          //  var j=arrayObjectIndexOf(global_text, global_text[i].id, "id"); //
//console.log(j);
//if(j!=-1)
createSVGtext(d3.select("#"+unique_global_text[i].id), unique_global_text[i].text, unique_global_text[i].coords.x, unique_global_text[i].coords.y);
/*
         d3.select("#"+unique_global_text[i].id).append("text")
          .text(unique_global_text[i].text)
          .attr("x",unique_global_text[i].coords.x-20)
          .attr("y",unique_global_text[i].coords.y);*/

        }
         //console.log(global_text);
        // webarch.createSVGtext(global_text[0].id, global_text[0].text, global_text[0].coords.x, global_text[0].coords.y);
        //var try_obj = new trycapture;
        //if(global_paths==''){}else{
        //try_obj.drawAggregate(global_paths[0].x1,global_paths[0].y1,global_paths[0].x2,global_paths[0].y2,global_paths[0].id);}
      }})
just_moved='';
//Trying to move paths around


function redrawrelations(id,x,y){
var x_value= document.getElementsByTagName("svg")[id].getAttribute("x");
}

      function arrayObjectIndexOf(myArray, searchTerm, property) {
          for(var i = myArray.length-1, len = 0; i => len; i--) {
            //console.log(i);
            //console.log(myArray[i][property],searchTerm);
              if (myArray[i][property] === searchTerm) return i;
          }
          return -1;
      }

      function arrayObjectIndexOfall(myArray, searchTerm, property) {
        var arrayoftoelements=[];
          for(var i = myArray.length-1, len = 0; i >= len; i--) {
            //console.log(i);
            //console.log(myArray[i][property],searchTerm);

              if (myArray[i][property] === searchTerm)
              {
                arrayoftoelements.push(i);
              }

          }
          return arrayoftoelements;
      }



</script>



</body>
</html>
